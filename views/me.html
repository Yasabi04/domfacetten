<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domfacetten - Produktübersicht</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/body.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/footer.css">
    <link rel="icon" href="../images/smallLogo.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Bodoni:ital,wght@0,400..700;1,400..700&family=Rufina:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="mainNavBar">
            <ul class = "navList">
                <li><a href="index.html">Hauptseite</a></li>
                <li><a href="productPage.html">Alle Produkte</a></li>
                <li><a href="me.html">Mein Bereich</a></li>
                <li><span class = "searchSymbol"><i class = "fas fa-search"></i></span></li>
                <li><span class="userSymbol"><i class="fa-regular fa-user"></i></span></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="productOverview">
            <div>
                <h1>Gespeichert</h1>
                <i class="fa-solid fa-filter filter"></i>
            </div>
            <hr>
                <section class = "safed"></section>
            <hr>
        </section>
        
    </main>
    <footer></footer>
    <script src = "./scripts/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    // Hole das gespeicherte Produkt-Array aus dem localStorage
    const products = JSON.parse(localStorage.getItem('safedProductList'));

    // Füge sicherheitshalber einen Check hinzu, ob das Array existiert und nicht leer ist
    if (products && products.length > 0) {
        // Finde das Element, in das du die Produktkarten einfügen möchtest (die Klasse 'safed')
        const safedContainer = document.querySelector('.safed');
        products.forEach(element => {
            // Erstelle eine neue article-Karte für jedes Produkt
            const productCard = document.createElement('article');
            productCard.classList.add('productCard');
            
            // Füge den HTML-Inhalt für jedes Produkt hinzu
            productCard.innerHTML = `
                <abbr title="Produkt aus Gespeichert entfernen">
                    <span class="star"><i class="fa-regular fa-trash-can"></i></span>
                </abbr>
                <img src="${element.foto}" alt="${element.bezeichnung}">
                <h2>${element.bezeichnung}</h2>
                <p>Preis ${element.preis} €</p>
            `;

            // Füge die Produktkarte zum Container hinzu
            safedContainer.appendChild(productCard);
        });
    }
});

// Füge einen Event-Listener auf das übergeordnete Element hinzu, das alle Produktkarten enthält
// Event-Delegation für das übergeordnete Element
document.querySelector('.safed').addEventListener('click', (event) => {
    // Prüfe, ob der Klick auf das Papierkorbsymbol erfolgt ist
    if (event.target.closest('.star')) {
        // Hole die Produktkarte
        const productCard = event.target.closest('.productCard');
        
        // Hole die Produktbezeichnung aus dem data-Attribut
        const productBezeichnung = productCard.getAttribute('data-bezeichnung');
        console.log('Produktbezeichnung:', productBezeichnung);

        // Hole das gespeicherte Produkt-Array aus dem localStorage
        let products = JSON.parse(localStorage.getItem('safedProductList')) || [];
        console.log('Aktuelle Produkte:', products);

        // Finde das Produkt im Array
        const productIndex = products.findIndex(product => product.bezeichnung === productBezeichnung);

        if (productIndex !== -1) {
            // Entferne das Produkt aus dem Array
            products.splice(productIndex, 1);

            // Speichere das aktualisierte Array im localStorage
            localStorage.setItem('safedProductList', JSON.stringify(products));

            // Entferne die Produktkarte aus dem DOM
            productCard.remove();

            console.log(`Produkt '${productBezeichnung}' wurde erfolgreich entfernt.`);
        } else {
            console.log(`Produkt '${productBezeichnung}' wurde nicht gefunden.`);
        }
    }
});

    </script>
</body>
</html>